import {Component} from '@angular/core';

interface Pregunta {
  id: number;
  texto: string;
  opciones: string[];
  correcta: number;
  valor: number;
  imagen?: string;
}

@Component({
  selector: 'app-examen-8',
  imports: [],
  templateUrl: './examen-8.html',
  styleUrl: './examen-8.css',
  standalone: true
})
export class Examen8 {
  preguntas: Pregunta[] = [
    {
      id: 1,
      texto: 'Para estacionar su veh√≠culo, en un lugar de la v√≠a donde no est√© prohibido hacerlo, usted tendr√° en cuenta hacerlo:',
      opciones: [
        'Con las ruedas del veh√≠culo a una distancia no mayor de 10 cent√≠metros del cont√©n o borde de la acera o de la calzada.',
        'A una distancia entre 30 y 50 cent√≠metros de otro veh√≠culo.',
        'Junto a la acera o borde derecho y en el sentido de la circulaci√≥n en calzadas de una direcci√≥n.'
      ],
      correcta: 0, // Inciso A
      valor: 5,
      imagen: 'assets/images/examen-8/8.1.jpg'
    },
    {
      id: 2,
      texto: 'Al estacionar su veh√≠culo en un lugar donde no exista prohibici√≥n para hacerlo, deber√° efectuarlo:',
      opciones: [
        'Paralelo a la direcci√≥n de la circulaci√≥n y junto a la acera y borde derecho de la calzada de dos direcciones.',
        'Entre una zona de seguridad y la acera.',
        'En el espacio de 20 metros hacia atr√°s y 10 metros hacia delante de la se√±al oficial de parada de √≥mnibus.'
      ],
      correcta: 0, // Inciso A
      valor: 5,
      imagen: 'assets/images/examen-8/8.2.jpg'
    },
    {
      id: 3,
      texto: 'Para estacionar su veh√≠culo, usted debe tener en cuenta que el parqueo se proh√≠be:',
      opciones: [
        'A una distancia de 50 cent√≠metros o m√°s de otro veh√≠culo.',
        'En el espacio comprendido de 20 metros hacia atr√°s y 10 metros hacia delante de la se√±al oficial de parada de √≥mnibus.',
        'Con las ruedas del veh√≠culo a una distancia de 10 cent√≠metros o menos del cont√©n de la acera o borde de la calzada.'
      ],
      correcta: 1, // Inciso B
      valor: 5,
      imagen: 'assets/images/examen-8/8.3.jpg'
    },
    {
      id: 4,
      texto: 'Cuando usted pretenda estacionar su veh√≠culo, debe conocer que el estacionamiento o parqueo se proh√≠be hacerlo:',
      opciones: [
        'Junto a la acera o borde izquierdo y en el sentido de la circulaci√≥n en calzadas de una direcci√≥n.',
        'A una distancia no menor de 50 cent√≠metros de otro veh√≠culo.',
        'En el espacio que comprende una zona de piquera de autom√≥viles de alquiler los d√≠as y horas en que se preste este servicio.'
      ],
      correcta: 2, // Inciso C
      valor: 5,
      imagen: 'assets/images/examen-8/8.4.jpg'
    },
    {
      id: 5,
      texto: 'Para estacionar su veh√≠culo, paralelo al borde de la acera, en un lugar de la v√≠a donde no exista prohibici√≥n para hacerlo, deber√° realizarlo:',
      opciones: [
        'Sobre la acera, paseo o c√©sped, siempre y cuando no exista otro espacio disponible para efectuarlo.',
        'Junto a la acera o borde izquierdo de la v√≠a y en el sentido de la circulaci√≥n en calzadas de una direcci√≥n.',
        'Frente a una distancia menor de cuatro metros, anterior y posterior, a un hidrante.'
      ],
      correcta: 1, // Inciso B
      valor: 5,
      imagen: 'assets/images/examen-8/8.5.jpg'
    },
    {
      id: 6,
      texto: 'Usted, como conductor de un veh√≠culo de motor, debe tener presente que el estacionamiento se proh√≠be:',
      opciones: [
        'Frente a una distancia mayor de cuatro metros, anterior y posterior, de un hidrante.',
        'A una distancia mayor de 50 cent√≠metros de otro veh√≠culo.',
        'En la parte de la v√≠a que circundan las islas o rotondas, situadas en la confluencia de las v√≠as.'
      ],
      correcta: 2, // Inciso C
      valor: 5,
      imagen: 'assets/images/examen-8/8.6.jpg'
    },
    {
      id: 7,
      texto: 'El estacionamiento o parqueo de veh√≠culos en lugares no prohibidos de la v√≠a debe efectuarse:',
      opciones: [
        'Con las ruedas del veh√≠culo a una distancia no mayor de 10 cent√≠metros del cont√©n de la acera o borde de la calzada.',
        'Entre dos zonas de seguridad.',
        'En el espacio comprendido entre las dos l√≠neas longitudinales continuas marcadas en el pavimento y que separan los sentidos de circulaci√≥n.'
      ],
      correcta: 0, // Inciso A
      valor: 5,
      imagen: 'assets/images/examen-8/8.7.jpg'
    },
    {
      id: 8,
      texto: 'El estacionamiento o parqueo de veh√≠culos en lugares no prohibidos de la v√≠a debe efectuarse:',
      opciones: [
        'En acera, paseo o c√©sped, siempre que no exista espacio disponible para hacerlo en la v√≠a.',
        'A una distancia no menor de 50 cent√≠metros de otro veh√≠culo.',
        'Entre dos zonas de seguridad.'
      ],
      correcta: 1, // Inciso B
      valor: 5,
      imagen: 'assets/images/examen-8/8.8.jpg'
    },
    {
      id: 9,
      texto: 'El estacionamiento o parqueo de veh√≠culos se proh√≠be:',
      opciones: [
        'En el espacio comprendido entre las dos l√≠neas longitudinales continuas marcadas en el pavimento y que separan los sentidos de circulaci√≥n, las que hacen funci√≥n de separador central al no existir este f√≠sicamente.',
        'A 70 cent√≠metros de otro veh√≠culo.',
        'Junto a la acera o borde izquierdo y en el sentido de la circulaci√≥n en calzadas de una direcci√≥n.'
      ],
      correcta: 0, // Inciso A
      valor: 5,
      imagen: 'assets/images/examen-8/8.9.jpg'
    },
    {
      id: 10,
      texto: 'El estacionamiento o parqueo de veh√≠culos se proh√≠be:',
      opciones: [
        'Paralela la direcci√≥n de la circulaci√≥n y junto a la acera y borde de la derecha en calzadas de dos direcciones.',
        'Frente a una distancia menor de cuatro metros, anterior y posterior, de un hidrante.',
        'En el espacio de 20 metros hacia delante y 10 metros hacia atr√°s de la se√±al oficial de parada de √≥mnibus destinado al servicio de transporte p√∫blico de pasajeros.'
      ],
      correcta: 1, // Inciso B
      valor: 5,
      imagen: 'assets/images/examen-8/8.10.jpg'
    },
    {
      id: 11,
      texto: 'El estacionamiento o parqueo de veh√≠culos en lugares no prohibidos de la v√≠a puede efectuarse:',
      opciones: [
        'En el espacio a partir de 20 metros hacia delante y de 10 metros hacia atr√°s de la se√±al oficial de parada de √≥mnibus destinado al servicio p√∫blico de pasajeros.',
        'En la entrada o salida de garajes, pistas y rampas.',
        'En zonas de carga, en las horas y d√≠as establecidos para las operaciones de carga y descarga, siempre que no dificulte u obstaculice dicha operaci√≥n.'
      ],
      correcta: 2, // Inciso C
      valor: 5,
      imagen: 'assets/images/examen-8/8.11.jpg'
    },
    {
      id: 12,
      texto: 'El estacionamiento o parqueo de veh√≠culos se proh√≠be:',
      opciones: [
        'Frente a la entrada principal de edificios p√∫blicos, aunque no obstruccione o dificulte la entrada o salida a estos.',
        'En los puentes, intercambios, pasos a nivel, curvas de visibilidad reducida y en la proximidad de un cambio de rasante, aunque la detenci√≥n es moment√°nea.',
        'Frente a una distancia mayor de cuatro metros, anterior y posterior, de un hidrante.'
      ],
      correcta: 1, // Inciso B
      valor: 5,
      imagen: 'assets/images/examen-8/8.12.jpg'
    },
    {
      id: 13,
      texto: 'Conduciendo por una v√≠a de doble sentido de circulaci√≥n, de dos carriles en cada uno de los sentidos, usted pretende adelantar al veh√≠culo que circula delante del suyo. Para hacer la maniobra con seguridad, deber√° tener en cuenta:',
      opciones: [
        'Efectuar el paso o adelantamiento por la senda izquierda.',
        'Realizarlo por la senda de la derecha, cuando el veh√≠culo a adelantar est√° circulando a una velocidad reducida.',
        'Realizar la maniobra inmediatamente despu√©s de haber accionado las se√±ales de luces direccionales o intermitentes.'
      ],
      correcta: 0, // Inciso A
      valor: 5,
      imagen: 'assets/images/examen-8/8.13.jpg'
    },
    {
      id: 14,
      texto: 'Circulando por una v√≠a de un solo sentido de circulaci√≥n, usted requiere incorporarse a una v√≠a de doble sentido, en una intersecci√≥n donde no existe se√±al que indica la prioridad de las v√≠as. Para ello est√° obligado a:',
      opciones: [
        'Detener la marcha, cualesquiera que sean las condiciones de visibilidad.',
        'Ceder el paso o detenerse si es necesario, ante el veh√≠culo que se aproxima por la v√≠a transversal.',
        'Ceder el paso o detenerse si es necesario, ante el veh√≠culo que por la v√≠a transversal se aproxima por su lado derecho.'
      ],
      correcta: 2, // Inciso C
      valor: 5,
      imagen: 'assets/images/examen-8/8.14.jpg'
    },
    {
      id: 15,
      texto: 'Conduciendo por una v√≠a de doble sentido de circulaci√≥n, decide detenerse con la intensi√≥n de recoger a una persona que le hace se√±as desde la acera. Para hacerlo con seguridad, usted est√° obligado a:',
      opciones: [
        'No emprender nuevamente la marcha cuando la persona haya terminado de subir y la puerta se encuentre debidamente cerrada.',
        'Mantener el veh√≠culo detenido por no menos de tres minutos.',
        'Realizar la detenci√≥n donde no exista prohibici√≥n de estacionamiento o parqueo, mediante la se√±al correspondiente.'
      ],
      correcta: 0, // Inciso A
      valor: 5,
      imagen: 'assets/images/examen-8/8.15.jpg'
    },
    {
      id: 16,
      texto: 'Circulando por una v√≠a de un solo sentido de circulaci√≥n, usted requiere realizar el cruce de otra v√≠a con igual categor√≠a, en una intersecci√≥n donde no existe se√±al que indica la prioridad de las v√≠as. Para ello est√° obligado a:',
      opciones: [
        'Disminuir la velocidad y parar si fuera necesario, a fin de permitir el paso a todos los veh√≠culos que se aproximan por la v√≠a transversal.',
        'Ceder el paso o detenerse si es necesario, ante el veh√≠culo que por la v√≠a transversal se aproxima por su lado derecho.',
        'Ceder el paso a los veh√≠culos que se aproximan en sentido opuesto, por la misma v√≠a.'
      ],
      correcta: 1, // Inciso B
      valor: 5,
      imagen: 'assets/images/examen-8/8.16.jpg'
    },
    {
      id: 17,
      texto: 'Circulando por una v√≠a de doble sentido de circulaci√≥n, usted pretende doblar a la izquierda, para incorporarse a otra, en una intersecci√≥n donde no existe se√±al que indica la prioridad de las v√≠as. Para ello est√° obligado a:',
      opciones: [
        'Ceder el paso al veh√≠culo que se aproxima por la senda o carril a la que pretende incorporarse.',
        'Ceder el paso o detenerse si es necesario, ante el veh√≠culo que por la v√≠a transversal se aproxima por su lado izquierdo.',
        'Ceder el paso a los veh√≠culos que se aproximan en sentido opuesto por la misma v√≠a.'
      ],
      correcta: 2, // Inciso C
      valor: 5,
      imagen: 'assets/images/examen-8/8.17.jpg'
    },
    {
      id: 18,
      texto: 'Al circular, incorporarse o cruzar una v√≠a, ante la se√±al de "Pare", como conductor de un veh√≠culo est√° usted obligado a:',
      opciones: [
        'Detener la marcha cualesquiera que sean las condiciones de visibilidad, d√°ndole prioridad a los veh√≠culos que circulan por la v√≠a transversal.',
        'Detener la marcha cuando las condiciones de visibilidad no permita realizar la maniobra sin riesgo.',
        'Disminuir la velocidad y parar si fuera necesario, a fin de permitir el paso a todos los veh√≠culos que se aproximen por la v√≠a transversal.'
      ],
      correcta: 0, // Inciso A
      valor: 5,
      imagen: 'assets/images/examen-8/8.18.jpg'
    },
    {
      id: 19,
      texto: 'Circulando en la corriente vehicular usted requiere adelantar al veh√≠culo que circula delante. Para realizar la maniobra de adelantamiento usted est√° obligado a:',
      opciones: [
        'Comprobar que puede efectuarlo sin ninguna interferencia a los dem√°s conductores de veh√≠culos.',
        'Realizar el adelantamiento por la senda de la derecha, cuando el veh√≠culo a adelantar circula por debajo de la velocidad m√≠nima obligatoria para la v√≠a.',
        'Realizar la maniobra una vez accionada las luces direccionales e intermitentes.'
      ],
      correcta: 0, // Inciso A
      valor: 5,
      imagen: 'assets/images/examen-8/8.19.jpg'
    },
    {
      id: 20,
      texto: 'Conduciendo por una v√≠a de doble sentido de circulaci√≥n, decide detenerse con la intensi√≥n de recoger a una persona que le hace se√±as desde la acera. Para hacerlo con seguridad, usted est√° obligado a:',
      opciones: [
        'Emprender nuevamente la marcha cuando la persona haya terminado de subir y la puerta se encuentre debidamente cerrada.',
        'Mantener el veh√≠culo detenido por no menos de tres minutos.',
        'Realizar la detenci√≥n donde no exista prohibici√≥n de estacionamiento o parqueo, mediante la se√±al correspondiente.'
      ],
      correcta: 0, // Inciso A
      valor: 5,
      imagen: 'assets/images/examen-8/8.20.jpg'
    }
  ];

  resultado: number | null = null;
  resultadoTexto: string = '';
  examenRevisado: boolean = false;
  respuestasUsuario: { [key: number]: number } = {};
  mostrarImagenes: boolean = true;
  currentYear: number = new Date().getFullYear();

  constructor() {
    if (typeof window !== 'undefined' && window.innerWidth < 1024) {
      this.mostrarImagenes = false;
    }
  }

  toggleImagenes(): void {
    this.mostrarImagenes = !this.mostrarImagenes;
  }

  seleccionarRespuesta(preguntaId: number, opcionIndex: number): void {
    this.respuestasUsuario[preguntaId] = opcionIndex;
  }

  verResultado(): void {
    const preguntasFaltantes: number[] = [];
    for (let i = 1; i <= 20; i++) {
      if (this.respuestasUsuario[i] === undefined) {
        preguntasFaltantes.push(i);
      }
    }

    let total = 0;
    this.preguntas.forEach(pregunta => {
      const respuestaUsuario = this.respuestasUsuario[pregunta.id];
      if (respuestaUsuario !== undefined && respuestaUsuario === pregunta.correcta) {
        total += pregunta.valor;
      }
    });

    this.resultado = total;

    if (preguntasFaltantes.length > 0) {
      alert(`‚ö†Ô∏è Preguntas no contestadas: ${preguntasFaltantes.join(', ')} - Valen 0 puntos`);
    }

    if (total >= 70) {
      this.resultadoTexto = `‚úÖ Usted ha Aprobado el Examen con ${total} Puntos`;
      alert('üéâ Felicitaciones, ha aprobado el examen. Le recomendamos que si conduce en la v√≠a p√∫blica aplique estos conocimientos.');
    } else {
      this.resultadoTexto = `‚ùå Usted ha Suspendido este Examen con ${total} Puntos`;
      alert(`üìö No ha alcanzado los 70 puntos. Obtuvo ${total} puntos. Siga estudiando.`);
    }
  }

  revisarExamen(): void {
    if (this.resultado === null) {
      this.verResultado();
    }
    this.examenRevisado = true;
  }

  cerrarRevision(): void {
    this.examenRevisado = false;
  }

  getPuntajePregunta(preguntaId: number): number {
    const pregunta = this.preguntas.find(p => p.id === preguntaId);
    if (pregunta && this.respuestasUsuario[preguntaId] !== undefined &&
      this.respuestasUsuario[preguntaId] === pregunta.correcta) {
      return pregunta.valor;
    }
    return 0;
  }

  reiniciarExamen(): void {
    if (confirm('¬øEst√°s seguro de que deseas reiniciar el examen?')) {
      this.respuestasUsuario = {};
      this.resultado = null;
      this.resultadoTexto = '';
      this.examenRevisado = false;
    }
  }

  onImageError(event: any): void {
    console.error('Error cargando imagen:', event.target.src);
    event.target.src = 'assets/images/placeholder.jpg';
  }

  getLetraRespuesta(index: number): string {
    return index === 0 ? 'A' : index === 1 ? 'B' : 'C';
  }
}
