import {Component} from '@angular/core';
import {NgForOf, NgIf} from '@angular/common';

interface Pregunta {
  id: number;
  texto: string;
  opciones: string[];
  correcta: number;
  valor: number;
  imagen?: string; // Imagen espec√≠fica para esta pregunta
}

@Component({
  selector: 'app-examen-5',
  imports: [
    NgForOf,
    NgIf
  ],
  templateUrl: './examen-5.html',
  styleUrl: './examen-5.css',
  standalone: true
})
export class Examen5 {
  preguntas: Pregunta[] = [
    {
      id: 1,
      texto: 'Esta se√±al indica:',
      opciones: [
        'La proximidad de una curva hacia el lado derecho del sentido de la circulaci√≥n.',
        'Proximidad de una curva hacia el lado izquierdo del sentido de la circulaci√≥n.',
        'Doble curva a la derecha.'
      ],
      correcta: 1, // Inciso B - Proximidad de una curva hacia el lado izquierdo
      valor: 5,
      imagen: 'assets/images/examen-5/5.1.jpg'
    },
    {
      id: 2,
      texto: 'Al llegar a una intersecci√≥n encuentra a su derecha una se√±al de PARE y un sem√°foro proyectando la luz verde. ¬øQu√© debe hacer?',
      opciones: [
        'Los conductores de veh√≠culos pueden continuar la marcha por la v√≠a en que circulan, porque la luz exime de cumplir la se√±al vertical.',
        'Detenerme y ceder el paso a los veh√≠culos que circulan por la v√≠a transversal.',
        'Circular con precauci√≥n y detenerme s√≥lo si tengo que ceder el paso a los veh√≠culos que circulen por la v√≠a transversal.'
      ],
      correcta: 0, // Inciso A - Continuar la marcha
      valor: 5,
      imagen: 'C5P2.jpg'
    },
    {
      id: 3,
      texto: 'Para advertir al conductor de un veh√≠culo que circula delante, su intenci√≥n de adelantarle, usted realiza una se√±al lum√≠nica:',
      opciones: [
        'Accionando de forma intermitente las luces corta y larga, alternativamente.',
        'Con la luz direccional e intermitente izquierda.',
        'Con la luz de cruce corta.'
      ],
      correcta: 0, // Inciso A - Luces corta y larga alternativamente
      valor: 5,
      imagen: 'C5P3.jpg'
    },
    {
      id: 4,
      texto: 'En caso de niebla densa. Usted est√° obligado a:',
      opciones: [
        'Aumentar la distancia segura de frenado.',
        'Moderar la marcha y detenerla si fuera necesario.',
        'Utilizar las luces de niebla o las de cruce o cortas.'
      ],
      correcta: 2, // Inciso C - Utilizar luces de niebla o cruce
      valor: 5,
      imagen: 'C5P4.jpg'
    },
    {
      id: 5,
      texto: 'Conduciendo durante la noche por una zona rural utilizar√° las luces de carreteras o largas:',
      opciones: [
        'Durante todo el trayecto.',
        'Siempre que no causen deslumbramiento a los conductores de veh√≠culos que circulan en sentido contrario.',
        'En casos de niebla densa o lluvia intensa.'
      ],
      correcta: 1, // Inciso B - Siempre que no causen deslumbramiento
      valor: 5,
      imagen: 'C5P5.jpg'
    },
    {
      id: 6,
      texto: 'Para circular por la v√≠a con seguridad, durante las horas comprendidas del anochecer al amanecer, las luces de cruce o cortas de los veh√≠culos de motor deben alumbrar la v√≠a con eficacia hasta una distancia por delante del veh√≠culo no menor de:',
      opciones: [
        '60 metros por delante del veh√≠culo.',
        '40 metros por delante del veh√≠culo.',
        '50 metros por delante del veh√≠culo.'
      ],
      correcta: 0, // Inciso A - 60 metros
      valor: 5,
      imagen: 'C5P6.jpg'
    },
    {
      id: 7,
      texto: 'Todo autom√≥vil capaz de alcanzar una velocidad superior a los 40 Km/horas debe estar provisto de dos luces de carretera o larga que puedan alumbrar con eficacia la v√≠a hasta una distancia, por delante del veh√≠culo, no menor de:',
      opciones: [
        '80 metros.',
        '90 metros.',
        '100 metros.'
      ],
      correcta: 2, // Inciso C - 100 metros
      valor: 5,
      imagen: 'C5P7.jpg'
    },
    {
      id: 8,
      texto: 'Circula usted por una v√≠a urbana con su autom√≥vil, a la velocidad de:',
      opciones: [
        '50 km/h.',
        '70 km/h.',
        '100 km/h.'
      ],
      correcta: 0, // Inciso A - 50 km/h
      valor: 5,
      imagen: 'C5P8.jpg'
    },
    {
      id: 9,
      texto: 'Circula usted en carretera con su autom√≥vil con un peso m√°ximo de hasta 3500 kilogramos y debe conducir a:',
      opciones: [
        '50 km/h.',
        '90 km/h.',
        '100 km/h.'
      ],
      correcta: 1, // Inciso B - 90 km/h
      valor: 5,
      imagen: 'C5P9.jpg'
    },
    {
      id: 10,
      texto: 'Cuando usted conduce por un t√∫nel suficientemente alumbrado. ¬øEs necesario encender las luces?',
      opciones: [
        'S√≠, debo encender las luces de cruce o cortas o de posici√≥n.',
        'No, porque con la iluminaci√≥n de la v√≠a es suficiente.',
        'S√≠, solo las de posici√≥n, para advertir mi presencia.'
      ],
      correcta: 0, // Inciso A - S√≠, encender luces
      valor: 5,
      imagen: 'C5P10.jpg'
    },
    {
      id: 11,
      texto: 'Los poseedores legales de veh√≠culos quedan obligados a comunicar al registro, dentro de los 10 d√≠as siguientes de haberse realizado:',
      opciones: [
        'La Reinscripci√≥n.',
        'El cambio de chapas.',
        'El cambio de color del veh√≠culo.'
      ],
      correcta: 2, // Inciso C - Cambio de color
      valor: 5,
      imagen: 'C5P11.jpg'
    },
    {
      id: 12,
      texto: 'Usted como conductor de cualquier veh√≠culo de motor, para efectuar la maniobra de giro o cambio de carril o senda a la izquierda, deber√° tener presente:',
      opciones: [
        'Accionar las luces direccionales e intermitentes a la izquierda o sacar el brazo y extenderlo en posici√≥n horizontal.',
        'Accionar las luces direccionales e intermitentes a la izquierda y sacar el brazo en posici√≥n vertical hacia arriba con la palma de la mano hacia atr√°s.',
        'Accionar las luces direccionales e intermitentes a la izquierda y sacar el brazo manteni√©ndolo en posici√≥n inclinada hacia abajo con la palma de la mano hacia atr√°s.'
      ],
      correcta: 0, // Inciso A - Brazo en posici√≥n horizontal
      valor: 5,
      imagen: 'C5P12.jpg'
    },
    {
      id: 13,
      texto: 'Un ciudadano se presenta a las oficinas Licencia de Conducci√≥n con el objetivo de obtener la licencia de conducci√≥n categor√≠a D, el mismo no es titular de licencia de ninguna categor√≠a. ¬øPodr√° cumplir la pretensi√≥n el aspirante?',
      opciones: [
        'S√≠, porque es su voluntad conducir ese tipo de veh√≠culo.',
        'No, porque no tiene los conocimientos necesarios para conducir camiones.',
        'No, porque debe ser titular de una licencia de conducci√≥n de la categor√≠a B y tener 2 a√±os de experiencia en la misma.'
      ],
      correcta: 2, // Inciso C - Requisitos categor√≠a D
      valor: 5,
      imagen: 'C5P133.jpg'
    },
    {
      id: 14,
      texto: 'El estacionamiento o parqueo de un veh√≠culo podr√° realizarse:',
      opciones: [
        'A una distancia no menor de 50 cm. de otro veh√≠culo.',
        'A una distancia mayor de 20 cm. del cont√©n.',
        'En salidas de garajes.'
      ],
      correcta: 0, // Inciso A - 50 cm de otro veh√≠culo
      valor: 5,
      imagen: 'C5P14.jpg'
    },
    {
      id: 15,
      texto: 'El conductor de un veh√≠culo al estacionarlo o parquearlo en las v√≠as autorizadas, esta obligado a:',
      opciones: [
        'Medir la presi√≥n de inflado de los neum√°ticos.',
        'Parar el motor del veh√≠culo cerrando el chucho o interruptor.',
        'Estacionarlo entre una zona de seguridad y la acera.'
      ],
      correcta: 1, // Inciso B - Parar el motor
      valor: 5,
      imagen: 'C5P15.jpg'
    },
    {
      id: 16,
      texto: 'Transitando usted por una carretera, conduciendo un veh√≠culo r√≠gido o articulado, destinado al transporte de carga, la velocidad que podr√° desarrollar en su desplazamiento no exceder√°:',
      opciones: [
        '80 km/h.',
        '90 km/h.',
        '100 km/h.'
      ],
      correcta: 0, // Inciso A - 80 km/h
      valor: 5,
      imagen: 'C5P16.jpg'
    },
    {
      id: 17,
      texto: 'En v√≠as urbanas de un solo sentido de circulaci√≥n el estacionamiento o parqueo se efectuar√°:',
      opciones: [
        'Del lado derecho de la v√≠a.',
        'Del lado izquierdo de la v√≠a.',
        'En ambos sentidos de direcci√≥n.'
      ],
      correcta: 1, // Inciso B - Lado izquierdo
      valor: 5,
      imagen: 'C5P177.JPG'
    },
    {
      id: 18,
      texto: 'De noche, dentro de per√≠metros urbanos, ¬øEst√° permitido utilizar la luz larga o de carretera?',
      opciones: [
        'S√≠, pero √∫nicamente cuando circule a m√°s de 40 km/h y la v√≠a no est√© iluminada.',
        'S√≠, cuando la v√≠a est√© suficientemente iluminada.',
        'No, s√≥lo pueden utilizarse cuando haya inutilizaci√≥n, deficiencia o aver√≠a del alumbrado.'
      ],
      correcta: 2, // Inciso C - No, solo en aver√≠as
      valor: 5,
      imagen: 'C5P18.jpg'
    },
    {
      id: 19,
      texto: 'Conduciendo usted por una autopista, un autom√≥vil que no excede en su peso los 3500 Kg, la velocidad que puede alcanzar con su veh√≠culo no ser√° superior a:',
      opciones: [
        '100 km/h.',
        '90 km/h.',
        '80 km/h.'
      ],
      correcta: 0, // Inciso A - 100 km/h
      valor: 5,
      imagen: 'C5P19.jpg'
    },
    {
      id: 20,
      texto: 'Circula usted con un equipo especializado para la construcci√≥n, tractores y otros equipos agr√≠colas y debe conducir a:',
      opciones: [
        '70 km/h.',
        '20 km/h.',
        '90 km/h.'
      ],
      correcta: 1, // Inciso B - 20 km/h
      valor: 5,
      imagen: 'C5P20.jpg'
    }
  ];

  imagenesApoyo: string[] = [
    'C5P1.jpg',
    'C5P2.jpg',
    'C5P3.jpg',
    'C5P4.jpg',
    'C5P5.jpg',
    'C5P6.jpg',
    'C5P7.jpg',
    'C5P8.jpg',
    'C5P9.jpg',
    'C5P10.jpg',
    'C5P11.jpg',
    'C5P12.jpg',
    'C5P133.jpg',
    'C5P14.jpg',
    'C5P15.jpg',
    'C5P16.jpg',
    'C5P177.JPG',
    'C5P18.jpg',
    'C5P19.jpg',
    'C5P20.jpg'
  ];

  resultado: number | null = null;
  resultadoTexto: string = '';
  examenRevisado: boolean = false;
  respuestasUsuario: { [key: number]: number } = {};
  mostrarImagenes: boolean = true;
  currentYear: number = new Date().getFullYear();

  constructor() {
    if (typeof window !== 'undefined' && window.innerWidth < 1024) {
      this.mostrarImagenes = false;
    }
  }

  toggleImagenes(): void {
    this.mostrarImagenes = !this.mostrarImagenes;
  }

  seleccionarRespuesta(preguntaId: number, opcionIndex: number): void {
    this.respuestasUsuario[preguntaId] = opcionIndex;
  }

  verResultado(): void {
    const preguntasFaltantes: number[] = [];
    for (let i = 1; i <= 20; i++) {
      if (this.respuestasUsuario[i] === undefined) {
        preguntasFaltantes.push(i);
      }
    }

    let total = 0;
    this.preguntas.forEach(pregunta => {
      const respuestaUsuario = this.respuestasUsuario[pregunta.id];
      if (respuestaUsuario !== undefined && respuestaUsuario === pregunta.correcta) {
        total += pregunta.valor;
      }
    });

    this.resultado = total;

    if (preguntasFaltantes.length > 0) {
      alert(`‚ö†Ô∏è Preguntas no contestadas: ${preguntasFaltantes.join(', ')} - Valen 0 puntos`);
    }

    if (total >= 70) {
      this.resultadoTexto = `‚úÖ Usted ha Aprobado el Examen con ${total} Puntos`;
      alert('üéâ Felicitaciones, ha aprobado el examen. Le recomendamos que si conduce en la v√≠a p√∫blica aplique estos conocimientos.');
    } else {
      this.resultadoTexto = `‚ùå Usted ha Suspendido este Examen con ${total} Puntos`;
      alert(`üìö No ha alcanzado los 70 puntos. Obtuvo ${total} puntos. Siga estudiando.`);
    }
  }

  revisarExamen(): void {
    if (this.resultado === null) {
      this.verResultado();
    }
    this.examenRevisado = true;
  }

  cerrarRevision(): void {
    this.examenRevisado = false;
  }

  getPuntajePregunta(preguntaId: number): number {
    const pregunta = this.preguntas.find(p => p.id === preguntaId);
    if (pregunta && this.respuestasUsuario[preguntaId] !== undefined &&
      this.respuestasUsuario[preguntaId] === pregunta.correcta) {
      return pregunta.valor;
    }
    return 0;
  }

  reiniciarExamen(): void {
    if (confirm('¬øEst√°s seguro de que deseas reiniciar el examen?')) {
      this.respuestasUsuario = {};
      this.resultado = null;
      this.resultadoTexto = '';
      this.examenRevisado = false;
    }
  }

  onImageError(event: any): void {
    event.target.src = 'assets/images/placeholder.jpg';
  }

  getLetraRespuesta(index: number): string {
    return index === 0 ? 'A' : index === 1 ? 'B' : 'C';
  }
}
