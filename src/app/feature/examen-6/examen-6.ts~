import {Component} from '@angular/core';
import {NgForOf, NgIf} from '@angular/common';

interface Pregunta {
  id: number;
  texto: string;
  opciones: string[];
  correcta: number;
  valor: number;
  imagen?: string;
}

@Component({
  selector: 'app-examen-6',
  imports: [
    NgIf,
    NgForOf
  ],
  templateUrl: './examen-6.html',
  styleUrl: './examen-6.css',
  standalone: true
})
export class Examen6 {
  preguntas: Pregunta[] = [
    {
      id: 1,
      texto: 'Le est√° permitido, de acuerdo con las circunstancias que se observan en la se√±al, a:',
      opciones: [
        'Acceso prohibido.',
        'Circulaci√≥n prohibida.',
        'Circulaci√≥n prohibida a todo tipo de veh√≠culo de motor.'
      ],
      correcta: 1, // Inciso B - Circulaci√≥n prohibida
      valor: 5,
      imagen: 'assets/images/examen-6/6.1.jpg'
    },
    {
      id: 2,
      texto: 'Cuando se observa esta se√±al ¬øSe permite el adelantamiento?',
      opciones: [
        'Nunca, para ning√∫n veh√≠culo de motor, excepto los ciclos y las motocicletas de 2 ruedas.',
        'S√≥lo a los veh√≠culos de carga y pasajeros.',
        'S√≥lo a los veh√≠culos que circulan por debajo del l√≠mite m√°ximo de velocidad permitido.'
      ],
      correcta: 0, // Inciso A - Nunca, excepto ciclos y motocicletas
      valor: 5,
      imagen: 'assets/images/examen-6/6.2.jpg'
    },
    {
      id: 3,
      texto: 'La se√±al que se relaciona pertenece al grupo de Prioridad, la cual indica:',
      opciones: [
        'Disminuir la marcha y continuar.',
        'Que est√° obligado a detenerse en la l√≠nea de Pare.',
        'S√≥lo a los veh√≠culos que circulan por debajo del l√≠mite m√°ximo de velocidad permitido.'
      ],
      correcta: 1, // Inciso B - Detenerse en la l√≠nea de Pare
      valor: 5,
      imagen: 'assets/images/examen-6/6.3.jpg'
    },
    {
      id: 4,
      texto: 'Se proh√≠be a los peatones al circular por una v√≠a:',
      opciones: [
        'Cruzar una v√≠a urbana o rural entre veh√≠culos estacionados.',
        'Caminar por el lado derecho de la direcci√≥n en que transmite en v√≠as urbanas.',
        'Circular lo m√°s pr√≥ximo posible al cont√©n de la acera o borde de la misma.'
      ],
      correcta: 0, // Inciso A - Cruzar entre veh√≠culos estacionados
      valor: 5,
      imagen: 'assets/images/examen-6/6.4.jpg'
    },
    {
      id: 5,
      texto: 'Un veh√≠culo de motor capaz de alcanzar una velocidad superior a 25 Km/h, debe estar provisto en la parte posterior de:',
      opciones: [
        'Dos luces de frenado de color rojo cuya intensidad sea superior a las de posici√≥n trasera.',
        'Luz corta o de cruce que pueda alumbrar con eficiencia la v√≠a.',
        'Luces cortas y largas que puedan alumbrar con eficiencia la v√≠a.'
      ],
      correcta: 0, // Inciso A - Dos luces de frenado rojo
      valor: 5,
      imagen: 'assets/images/examen-6/6.5.jpg'
    },
    {
      id: 6,
      texto: 'Se proh√≠be la circulaci√≥n de veh√≠culos cuando:',
      opciones: [
        'La carga √∫til est√° comprendida entre 20 y 25 Toneladas M√©tricas de peso, para veh√≠culos r√≠gidos.',
        'La carga √∫til exceda de 30 Toneladas m√©tricas, en casos de veh√≠culos r√≠gidos y articulados.',
        'La carga √∫til sea inferior a 25 Toneladas M√©tricas, en el caso de veh√≠culos articulados.'
      ],
      correcta: 1, // Inciso B - Exceda de 30 Toneladas
      valor: 5,
      imagen: 'assets/images/examen-6/6.6.jpg'
    },
    {
      id: 7,
      texto: 'Como norma general, est√° prohibido adelantar en:',
      opciones: [
        'En pasos peatonales.',
        'En las curvas de visibilidad reducida.',
        'En los caminos de tierra o terrapl√©n.'
      ],
      correcta: 1, // Inciso B - Curvas de visibilidad reducida
      valor: 5,
      imagen: 'assets/images/examen-6/6.7.jpg'
    },
    {
      id: 8,
      texto: 'A los conductores de ciclos se les proh√≠be transitar en:',
      opciones: [
        'En v√≠as de doble sentido de circulaci√≥n.',
        'A 1.50 metros de acera o borde de la calzada.',
        'Conversando con otro conductor.'
      ],
      correcta: 2, // Inciso C - Conversando con otro conductor
      valor: 5,
      imagen: 'assets/images/examen-6/6.8.jpg'
    },
    {
      id: 9,
      texto: 'La caja de cambio de velocidad de un veh√≠culo se utiliza para:',
      opciones: [
        'Liberar el movimiento del motor de la transmisi√≥n.',
        'Trasmitir el movimiento del motor al embrague.',
        'Trasmitir mayor o menor velocidad de giros al √°rbol de transmisi√≥n.'
      ],
      correcta: 2, // Inciso C - Transmitir mayor o menor velocidad
      valor: 5,
      imagen: 'assets/images/examen-6/6.9.jpg'
    },
    {
      id: 10,
      texto: 'Se proh√≠be al poseedor legal o persona encargada, por cualquier concepto, conducir un veh√≠culo o permitir que otro conduzca:',
      opciones: [
        'Cualquier veh√≠culo de transporte p√∫blico de pasajeros, portando la Licencia de Conducci√≥n con categor√≠a D.',
        'Cualquier veh√≠culo de uso personal cuando haya ingerido bebidas alcoh√≥licas en cualquier cantidad.',
        'Portando el permiso de aprendizaje, acompa√±ado por un titular de Licencia de Conducci√≥n de la categor√≠a a la que aspira.'
      ],
      correcta: 1, // Inciso B - Ingerido bebidas alcoh√≥licas
      valor: 5,
      imagen: 'assets/images/examen-6/6.10.jpg'
    },
    {
      id: 11,
      texto: '¬øC√≥mo se llama el mecanismo que regulan la entrada y salida de los gases en los cilindros del motor?',
      opciones: [
        'Sistema de encendido.',
        'Sistema de distribuci√≥n.',
        'Sistema de Gasificadores.'
      ],
      correcta: 1, // Inciso B - Sistema de distribuci√≥n
      valor: 5,
      imagen: 'assets/images/examen-6/6.11.jpg'
    },
    {
      id: 12,
      texto: '¬øEn un veh√≠culo de motor cuales son las ruedas directrices?',
      opciones: [
        'Las ruedas delanteras que son las que dirigen como conduce el conductor.',
        'Las ruedas que reciben la se√±al del motor.',
        'Son las ruedas traseras.'
      ],
      correcta: 0, // Inciso A - Ruedas delanteras
      valor: 5,
      imagen: 'assets/images/examen-6/6.12.jpg'
    },
    {
      id: 13,
      texto: 'Los cuatro tiempos del motor son:',
      opciones: [
        'Lubricaci√≥n, enfriamiento, alimentaci√≥n y escape.',
        'Admisi√≥n, Compresi√≥n, Explosi√≥n o Fuerza y escape.',
        'Combusti√≥n, compresi√≥n, admisi√≥n y expansi√≥n.'
      ],
      correcta: 1, // Inciso B - Admisi√≥n, Compresi√≥n, Explosi√≥n, Escape
      valor: 5,
      imagen: 'assets/images/examen-6/6.13.jpg'
    },
    {
      id: 14,
      texto: 'De las siguientes piezas ¬øDiga cu√°l pertenece al sistema el√©ctrico?',
      opciones: [
        'Radiador.',
        'Bielas.',
        'Condensador.'
      ],
      correcta: 2, // Inciso C - Condensador
      valor: 5,
      imagen: 'assets/images/examen-6/6.14.jpg'
    },
    {
      id: 15,
      texto: 'De las siguientes deficiencias t√©cnicas diga por cu√°l no pueden circular los veh√≠culos por las v√≠as del pa√≠s:',
      opciones: [
        'Cuando falte el limpiaparabrisas.',
        'Cuando existan salideros de aceite del motor.',
        'Cuando el juego libre del tim√≥n sea m√°s de 25 grados.'
      ],
      correcta: 2, // Inciso C - Juego del tim√≥n m√°s de 25 grados
      valor: 5,
      imagen: 'assets/images/examen-6/6.15.jpg'
    },
    {
      id: 16,
      texto: 'De las siguientes deficiencias t√©cnicas diga por cu√°l no puede circular un veh√≠culo por las v√≠as del pa√≠s:',
      opciones: [
        'Cuando falta el tubo de escape con su dispositivo de silenciador.',
        'Cuando exista salidero de aceite por el motor.',
        'Cuando el parabrisa est√© rajado.'
      ],
      correcta: 0, // Inciso A - Falta el tubo de escape
      valor: 5,
      imagen: 'assets/images/examen-6/6.16.jpg'
    },
    {
      id: 17,
      texto: 'La doble l√≠nea continua en el pavimento significa:',
      opciones: [
        'Que existe menor peligrosidad.',
        'Que la misma est√° pr√≥xima a continuar en una l√≠nea continua.',
        'Que ning√∫n veh√≠culo podr√° cruzarla ni circular sobre ella.'
      ],
      correcta: 2, // Inciso C - No cruzarla ni circular sobre ella
      valor: 5,
      imagen: 'assets/images/examen-6/6.17.jpg'
    },
    {
      id: 18,
      texto: 'El que conduzca cualquier veh√≠culo, de uso personal est√° obligado a mantener concentrada toda la atenci√≥n en su control y direcci√≥n, por lo que se proh√≠be:',
      opciones: [
        'Entablar conversaci√≥n con otra persona mientras conduce.',
        'Utilizar tel√©fonos u otros medios de comunicaci√≥n mientras que el veh√≠culo este en marcha.',
        'Mantener m√°s de 5 metros de distancia por cada 15 Km/h de velocidad entre veh√≠culos.'
      ],
      correcta: 1, // Inciso B - Utilizar tel√©fonos
      valor: 5,
      imagen: 'assets/images/examen-6/6.18.jpg'
    },
    {
      id: 19,
      texto: 'La se√±al que se relaciona indica:',
      opciones: [
        'El cruce con preferencia.',
        'La proximidad de un paso a nivel sin barreras.',
        'Que la v√≠a tiene preferencia en los cruces respecto a las dem√°s v√≠as que la atraviesan.'
      ],
      correcta: 2, // Inciso C - V√≠a con preferencia
      valor: 5,
      imagen: 'assets/images/examen-6/6.19.jpg'
    },
    {
      id: 20,
      texto: 'Un toque corto, del silbato, emitido por un agente del Orden P√∫blico indica:',
      opciones: [
        'Que puede reanudar la marcha.',
        'Que deben detener la marcha.',
        'Que debe disminuir la velocidad.'
      ],
      correcta: 0, // Inciso A - Reanudar la marcha
      valor: 5,
      imagen: 'assets/images/examen-6/6.20.jpg'
    }
  ];

  imagenesApoyo: string[] = [
    'assets/images/examen-6/6.1.jpg',
    'assets/images/examen-6/6.2.jpg',
    'assets/images/examen-6/6.3.jpg',
    'assets/images/examen-6/6.4.jpg',
    'assets/images/examen-6/6.5.jpg',
    'assets/images/examen-6/6.6.jpg',
    'assets/images/examen-6/6.7.jpg',
    'assets/images/examen-6/6.8.jpg',
    'assets/images/examen-6/6.9.jpg',
    'assets/images/examen-6/6.10.jpg',
    'assets/images/examen-6/6.11.jpg',
    'assets/images/examen-6/6.12.jpg',
    'assets/images/examen-6/6.13.jpg',
    'assets/images/examen-6/6.14.jpg',
    'assets/images/examen-6/6.15.jpg',
    'assets/images/examen-6/6.16.jpg',
    'assets/images/examen-6/6.17.jpg',
    'assets/images/examen-6/6.18.jpg',
    'assets/images/examen-6/6.19.jpg',
    'assets/images/examen-6/6.20.jpg'
  ];

  resultado: number | null = null;
  resultadoTexto: string = '';
  examenRevisado: boolean = false;
  respuestasUsuario: { [key: number]: number } = {};
  mostrarImagenes: boolean = true;
  currentYear: number = new Date().getFullYear();

  constructor() {
    if (typeof window !== 'undefined' && window.innerWidth < 1024) {
      this.mostrarImagenes = false;
    }
  }

  toggleImagenes(): void {
    this.mostrarImagenes = !this.mostrarImagenes;
  }

  seleccionarRespuesta(preguntaId: number, opcionIndex: number): void {
    this.respuestasUsuario[preguntaId] = opcionIndex;
  }

  verResultado(): void {
    const preguntasFaltantes: number[] = [];
    for (let i = 1; i <= 20; i++) {
      if (this.respuestasUsuario[i] === undefined) {
        preguntasFaltantes.push(i);
      }
    }

    let total = 0;
    this.preguntas.forEach(pregunta => {
      const respuestaUsuario = this.respuestasUsuario[pregunta.id];
      if (respuestaUsuario !== undefined && respuestaUsuario === pregunta.correcta) {
        total += pregunta.valor;
      }
    });

    this.resultado = total;

    if (preguntasFaltantes.length > 0) {
      alert(`‚ö†Ô∏è Preguntas no contestadas: ${preguntasFaltantes.join(', ')} - Valen 0 puntos`);
    }

    if (total >= 70) {
      this.resultadoTexto = `‚úÖ Usted ha Aprobado el Examen con ${total} Puntos`;
      alert('üéâ Felicitaciones, ha aprobado el examen. Le recomendamos que si conduce en la v√≠a p√∫blica aplique estos conocimientos.');
    } else {
      this.resultadoTexto = `‚ùå Usted ha Suspendido este Examen con ${total} Puntos`;
      alert(`üìö No ha alcanzado los 70 puntos. Obtuvo ${total} puntos. Siga estudiando.`);
    }
  }

  revisarExamen(): void {
    if (this.resultado === null) {
      this.verResultado();
    }
    this.examenRevisado = true;
  }

  cerrarRevision(): void {
    this.examenRevisado = false;
  }

  getPuntajePregunta(preguntaId: number): number {
    const pregunta = this.preguntas.find(p => p.id === preguntaId);
    if (pregunta && this.respuestasUsuario[preguntaId] !== undefined &&
      this.respuestasUsuario[preguntaId] === pregunta.correcta) {
      return pregunta.valor;
    }
    return 0;
  }

  reiniciarExamen(): void {
    if (confirm('¬øEst√°s seguro de que deseas reiniciar el examen?')) {
      this.respuestasUsuario = {};
      this.resultado = null;
      this.resultadoTexto = '';
      this.examenRevisado = false;
    }
  }

  onImageError(event: any): void {
    console.error('Error cargando imagen:', event.target.src);
    event.target.src = 'assets/images/placeholder.jpg';
  }

  getLetraRespuesta(index: number): string {
    return index === 0 ? 'A' : index === 1 ? 'B' : 'C';
  }
}
